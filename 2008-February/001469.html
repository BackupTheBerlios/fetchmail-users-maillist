<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [fetchmail-users] Fetchmail not collecting HTML messages using	IMAP
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/fetchmail-users/2008-February/index.html" >
   <LINK REL="made" HREF="mailto:fetchmail-users%40lists.berlios.de?Subject=Re%3A%20%5Bfetchmail-users%5D%20Fetchmail%20not%20collecting%20HTML%20messages%20using%0A%09IMAP&In-Reply-To=%3C43ea8d070802181343s73d13ab2ge944bcaebc42ef2a%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001468.html">
   <LINK REL="Next"  HREF="001470.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[fetchmail-users] Fetchmail not collecting HTML messages using	IMAP</H1>
    <B>Rob MacGregor</B> 
    <A HREF="mailto:fetchmail-users%40lists.berlios.de?Subject=Re%3A%20%5Bfetchmail-users%5D%20Fetchmail%20not%20collecting%20HTML%20messages%20using%0A%09IMAP&In-Reply-To=%3C43ea8d070802181343s73d13ab2ge944bcaebc42ef2a%40mail.gmail.com%3E"
       TITLE="[fetchmail-users] Fetchmail not collecting HTML messages using	IMAP">rob.macgregor at gmail.com
       </A><BR>
    <I>Mon Feb 18 22:43:11 CET 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001468.html">[fetchmail-users] Fetchmail not collecting HTML messages using	IMAP
</A></li>
        <LI>Next message: <A HREF="001470.html">[fetchmail-users] Fetchmail not collecting HTML messages using	IMAP
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1469">[ date ]</a>
              <a href="thread.html#1469">[ thread ]</a>
              <a href="subject.html#1469">[ subject ]</a>
              <a href="author.html#1469">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Feb 18, 2008 9:14 PM, Barnaby Garrett &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/fetchmail-users">barney at telinformix.com</A>&gt; wrote:
&gt;<i>
</I>&gt;<i> It might not know about the content but I've tested with plain text
</I>&gt;<i> (with and without attachments), rich text and html emails and it only
</I>&gt;<i> affects html ones.
</I>&gt;<i> It looks to me like something about the way the google IMAP servers
</I>&gt;<i> respond to the request for a message causes fetchmail to not send the
</I>&gt;<i> &lt;EOM&gt; to the SMTP server causing a timeout.
</I>
Have you done a tcpdump/wireshark/whatever to confirm this?

I'm just saying that I've *never* seen a case where fetchmail changed
*it's* behaviour because of the content.  How other servers behave is
beyond fetchmail's control.
&gt;<i> Indeed but why does it only happen when the message is picked up using
</I>&gt;<i> IMAP ?  Same message gets delivered to the SMTP server fine when
</I>&gt;<i> picked up using POP3
</I>
I don't know - ask your Exchange server ;)

&gt;<i> Yep running under Cygwin on Windows server 2003 ( The same one that is
</I>&gt;<i> running the Exchange server )
</I>
Known to be problematic - I would highly recommend that you run
fetchmail on a *nix box (even if only under VMWare).

&gt;<i> Logs from fetchmail :
</I>&gt;<i> fetchmail: 6.3.6 querying imap.googlemail.com (protocol IMAP) at Mon
</I>
You could try upgrading to 6.3.8, though I doubt it'll help.  You may
want to search the archive for other cygwin posts as there may have
been suggestions posted that can help.

&lt;---SNIP---&gt;
&gt;<i> fetchmail: IMAP&lt; * 7 FETCH (RFC822.HEADER {1445}
</I>&gt;<i> reading message <A HREF="https://lists.berlios.de/mailman/listinfo/fetchmail-users">USER at DOMAIN.COM</A>@googlemail-imap.l.google.com:7 of 11
</I>&gt;<i> (1445 header octets)
</I>&gt;<i> About to rewrite Return-Path: &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/fetchmail-users">SENDER at SENDER.DOMAIN.COM</A>&gt;
</I>&lt;---SNIP---&gt;
&gt;<i> Trying to connect to 127.0.0.1/25...connected.
</I>&gt;<i> fetchmail: SMTP&lt; 220 HOST.DOMAIN.COM Microsoft ESMTP MAIL Service,
</I>&gt;<i> Version: 6.0.3790.3959 ready at  Mon, 18 Feb 2008 20:45:53 +0000
</I>&gt;<i> fetchmail: SMTP&gt; EHLO HOST.DOMAIN.COM
</I>&gt;<i> fetchmail: SMTP&lt; 250-HOST.DOMAIN.COM Hello [127.0.0.1]
</I>&lt;---SNIP---&gt;
&gt;<i> fetchmail: SMTP&lt; 250 OK
</I>&gt;<i> fetchmail: forwarding to localhost
</I>&gt;<i> fetchmail: SMTP&gt; MAIL FROM:&lt;<A HREF="https://lists.berlios.de/mailman/listinfo/fetchmail-users">SENDER at SENDER.DOMAIN.COM</A>&gt; BODY=7BIT
</I>&gt;<i> SIZE=1570
</I>&gt;<i> fetchmail: SMTP&lt; 250 2.1.0 <A HREF="https://lists.berlios.de/mailman/listinfo/fetchmail-users">SENDER at SENDER.DOMAIN.COM....Sender</A> OK
</I>&gt;<i> fetchmail: SMTP&gt; RCPT TO:&lt;<A HREF="https://lists.berlios.de/mailman/listinfo/fetchmail-users">USER at DOMAIN.COM</A>&gt;
</I>&gt;<i> fetchmail: SMTP&lt; 250 2.1.5 <A HREF="https://lists.berlios.de/mailman/listinfo/fetchmail-users">USER at DOMAIN.COM</A>
</I>&gt;<i> fetchmail: SMTP&gt; DATA
</I>&gt;<i> fetchmail: SMTP&lt; 354 Start mail input; end with &lt;CRLF&gt;.&lt;CRLF&gt;
</I>&gt;<i> fetchmail: IMAP&lt; )
</I>&gt;<i> fetchmail: IMAP&lt; A0006 OK Success
</I>&gt;<i> fetchmail: IMAP&gt; A0007 FETCH 7 BODY.PEEK[TEXT]
</I>&gt;<i> fetchmail: IMAP&lt; * 7 FETCH (BODY[TEXT] {130}
</I>&gt;<i>   (130 body octets)fetchmail: IMAP&lt; )
</I>&gt;<i> fetchmail: IMAP&lt; A0007 OK Success
</I>&gt;<i> fetchmail: message <A HREF="https://lists.berlios.de/mailman/listinfo/fetchmail-users">USER at DOMAIN.COM</A>@googlemail-imap.l.google.com:7 was
</I>&gt;<i> not the expected length (1575 actual != 1570 expected)
</I>&gt;<i> fetchmail: SMTP&gt;. (EOM)
</I>&gt;<i> smtp listener protocol error
</I>&gt;<i>   not flushed
</I>
Ok, Fetchmail got the body (generated a warning to the effect that the
body was 5 bytes longer than expected), everything else looks fine.

I think you need to run packet capture to see exactly what's going on
between fetchmail and Exchange.  From what you've posted fetchmail
isn't badly configured and it looks like it's behaving correctly.

If it helps, I've just run fetchmail (6.3.8) against GMail's IMAP
server from a FreeBSD host and pulled down 10 emails (all passed to my
local Sendmail server), most of which were at least mixed plain/HTML
and some of which were pure HTML - supporting my statement that
fetchmail doesn't change it's behaviour depending on the content of
the email.

-- 
                 Please keep list traffic on the list.

Rob MacGregor
      Whoever fights monsters should see to it that in the process he
        doesn't become a monster.                  Friedrich Nietzsche

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001468.html">[fetchmail-users] Fetchmail not collecting HTML messages using	IMAP
</A></li>
	<LI>Next message: <A HREF="001470.html">[fetchmail-users] Fetchmail not collecting HTML messages using	IMAP
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1469">[ date ]</a>
              <a href="thread.html#1469">[ thread ]</a>
              <a href="subject.html#1469">[ subject ]</a>
              <a href="author.html#1469">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/fetchmail-users">More information about the fetchmail-users
mailing list</a><br>
</body></html>
