<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [fetchmail-users] ssl troubles
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/fetchmail-users/2012-July/index.html" >
   <LINK REL="made" HREF="mailto:fetchmail-users%40lists.berlios.de?Subject=Re%3A%20%5Bfetchmail-users%5D%20ssl%20troubles&In-Reply-To=%3C20120724225032.GA54757%40mech-cluster241.men.bris.ac.uk%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003193.html">
   <LINK REL="Next"  HREF="003195.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[fetchmail-users] ssl troubles</H1>
    <B>Anton Shterenlikht</B> 
    <A HREF="mailto:fetchmail-users%40lists.berlios.de?Subject=Re%3A%20%5Bfetchmail-users%5D%20ssl%20troubles&In-Reply-To=%3C20120724225032.GA54757%40mech-cluster241.men.bris.ac.uk%3E"
       TITLE="[fetchmail-users] ssl troubles">mexas at bristol.ac.uk
       </A><BR>
    <I>Wed Jul 25 00:50:32 CEST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="003193.html">[fetchmail-users] ssl troubles
</A></li>
        <LI>Next message: <A HREF="003195.html">[fetchmail-users] ssl troubles
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3194">[ date ]</a>
              <a href="thread.html#3194">[ thread ]</a>
              <a href="subject.html#3194">[ subject ]</a>
              <a href="author.html#3194">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Tue, Jul 24, 2012 at 11:14:40PM +0200, Matthias Andree wrote:
&gt;<i> Am 24.07.2012 16:05, schrieb Anton Shterenlikht:
</I>&gt;<i> &gt; Hi, I've read
</I>&gt;<i> &gt; <A HREF="http://fetchmail.berlios.de/fetchmail-FAQ.html#K5,">http://fetchmail.berlios.de/fetchmail-FAQ.html#K5,</A>
</I>&gt;<i> &gt; <A HREF="http://www.fetchmail.info/fetchmail-FAQ.html#R15,">http://www.fetchmail.info/fetchmail-FAQ.html#R15,</A>
</I>&gt;<i> &gt; but still don't understand how to use ssl
</I>&gt;<i> &gt; with fetchmail.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; I have:
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; $ cat .fetchmailrc 
</I>&gt;<i> &gt; poll imap.gmail.com protocol imap user &quot;mexas&quot; password &quot;xxx&quot; ssl fetchall
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; $ fetchmail
</I>&gt;<i> &gt; fetchmail: Server certificate verification error: unable to get local issuer certificate
</I>&gt;<i> &gt; fetchmail: This means that the root signing certificate (issued for /C=US/O=Google Inc/CN=Google Internet Authority) is not in the trusted CA certificate locations, or that c_rehash needs to be run on the certificate directory. For details, please see the documentation of --sslcertpath and --sslcertfile in the manual page.
</I>&gt;<i> &gt; fetchmail: Server certificate verification error: certificate not trusted
</I>&gt;<i> &gt; fetchmail: Warning: the connection is insecure, continuing anyways. (Better use --sslcertck!)
</I>&gt;<i> &gt; fetchmail: Authorization failure on <A HREF="https://lists.berlios.de/mailman/listinfo/fetchmail-users">mexas at gmail-imap.l.google.com</A>
</I>&gt;<i> &gt; fetchmail: For help, see <A HREF="http://www.fetchmail.info/fetchmail-FAQ.html#R15">http://www.fetchmail.info/fetchmail-FAQ.html#R15</A>
</I>&gt;<i> &gt; fetchmail: Query status=3 (AUTHFAIL)
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; This is on FreeBSD 10.0-CURRENT #6 r237134 ia64
</I>&gt;<i> &gt; with fetchmail built from ports with these options:
</I>&gt;<i> 
</I>&gt;<i> Anton,
</I>&gt;<i> 
</I>&gt;<i> which OpenSSL implementation is your fetchmail linked against?
</I>&gt;<i> [&quot;ldd /usr/local/bin/fetchmail&quot; should tell you that] -- From base
</I>&gt;<i> system or from ports?  I've admittedly never used the one from ports,
</I>&gt;<i> however, proper SSL verification with Google isn't a problem for me,
</I>&gt;<i> with fetchmail on amd64 FreeBSD 9-STABLE and with OpenSSL from the base
</I>&gt;<i> system.
</I>
It seems only the base system libs are used:

# ldd /usr/local/bin/fetchmail
/usr/local/bin/fetchmail:
        libintl.so.9 =&gt; /usr/local/lib/libintl.so.9 (0x120110000)
        libiconv.so.3 =&gt; /usr/local/lib/libiconv.so.3 (0x120132000)
        libopie.so.7 =&gt; /usr/lib/libopie.so.7 (0x120262000)
        libcrypt.so.5 =&gt; /lib/libcrypt.so.5 (0x120280000)
        libkvm.so.5 =&gt; /lib/libkvm.so.5 (0x1202ba000)
        libcom_err.so.5 =&gt; /usr/lib/libcom_err.so.5 (0x1202da000)
        libssl.so.6 =&gt; /usr/lib/libssl.so.6 (0x1202ec000)
        libcrypto.so.6 =&gt; /lib/libcrypto.so.6 (0x12038e000)
        libgssapi.so.10 =&gt; /usr/lib/libgssapi.so.10 (0x12063e000)
        libheimntlm.so.11 =&gt; /usr/lib/libheimntlm.so.11 (0x12065e000)
        libkrb5.so.11 =&gt; /usr/lib/libkrb5.so.11 (0x120678000)
        libhx509.so.11 =&gt; /usr/lib/libhx509.so.11 (0x12075a000)
        libasn1.so.11 =&gt; /usr/lib/libasn1.so.11 (0x1207e4000)
        libwind.so.11 =&gt; /usr/lib/libwind.so.11 (0x1208ea000)
        libheimbase.so.11 =&gt; /usr/lib/libheimbase.so.11 (0x120924000)
        libroken.so.11 =&gt; /usr/lib/libroken.so.11 (0x12093a000)
        libthr.so.3 =&gt; /lib/libthr.so.3 (0x120968000)
        libc.so.7 =&gt; /lib/libc.so.7 (0x1209b6000)
        libmd.so.6 =&gt; /lib/libmd.so.6 (0x120c66000)
#

&gt;<i> 
</I>&gt;<i> Can you check if you have the ca_root_nss port installed, and if so, adding
</I>&gt;<i> 
</I>&gt;<i>   --sslcertfile /usr/local/share/certs/ca-root-nss.crt
</I>&gt;<i> 
</I>&gt;<i> should do the trick in quenching the &quot;unable to get local issuer
</I>&gt;<i> certificate&quot; and &quot;certificate not trusted&quot; warnings.
</I>
yes, this does help with the university IMAP server, thank you
But not with gmail.com, please see below.

&gt;<i> 
</I>&gt;<i> Note that if Bristol University are using Kerberos for single-sign-on,
</I>&gt;<i> grabbing a proper krb5.ini or .conf and running &quot;kinit YOURLOGIN&quot; may
</I>&gt;<i> permit Kerberos authentication with fetchmail, too.
</I>
I don't really know anything about it, sorry.
But I'll check with the IT people.

Anyway, I now think I misunderstood the whole SSL thing.

The issue arose for me because
the university are subcontracting all mail
services to google. So at some point soon
the university IMAP and SMTP servers will
be switched off, and instead we'll have to use
imap.gmail.com and smtp.gmail.com.

The SMTP side works fine. I just replaced
the university SMTP server in /etc/mail/freebsd.mc
to smtp.gmail.com and it works as before.

The IMAP doesn't work, and when I started looking
at the error, I thought there something wrong with SSL.
I now understand that SSL is entirely optional, right?
In fact I see that I always got the same error
with the university IMAP server. I just never
paid any attention because I got my mail
delivered fine.

So I suspect that the google IMAP server
is not configured yet with the university
logins and passwords, because:

&gt;<i> Regarding the login, see Rob's posting.
</I>
I still get the same error no matter
which user I use:
mexas
<A HREF="https://lists.berlios.de/mailman/listinfo/fetchmail-users">mexas at bris.ac.uk</A>
<A HREF="https://lists.berlios.de/mailman/listinfo/fetchmail-users">mexas at bristol.ac.uk</A>
<A HREF="https://lists.berlios.de/mailman/listinfo/fetchmail-users">mexas at my.bristol.ac.uk</A>

For example:

$ cat .fetchmailrc
poll imap.gmail.com protocol imap user &quot;<A HREF="https://lists.berlios.de/mailman/listinfo/fetchmail-users">mexas at bristol.ac.uk</A>&quot; password &quot;xxxxx&quot; sslcertfile /usr/local/share/certs/ca-root-nss.crt fetchall

$ fetchmail -v
fetchmail: 6.3.21 querying imap.gmail.com (protocol IMAP) at Tue Jul 24 23:47:35
 2012: poll started
Trying to connect to 173.194.66.108/993...connected.
fetchmail: Server certificate:
fetchmail: Issuer Organization: Google Inc
fetchmail: Issuer CommonName: Google Internet Authority
fetchmail: Subject CommonName: imap.gmail.com
fetchmail: imap.gmail.com key fingerprint: 93:2E:0F:BA:58:EA:CD:CB:04:33:97:9D:2
3:2A:0A:77
fetchmail: IMAP&lt; * OK Gimap ready for requests from 137.222.187.241 c4if10832046
wiw.48
fetchmail: IMAP&gt; A0001 CAPABILITY
fetchmail: IMAP&lt; * CAPABILITY IMAP4rev1 UNSELECT IDLE NAMESPACE QUOTA ID XLIST C
HILDREN X-GM-EXT-1 XYZZY SASL-IR AUTH=XOAUTH
fetchmail: IMAP&lt; A0001 OK Thats all she wrote! c4if10832046wiw.48
fetchmail: IMAP&gt; A0002 LOGIN &quot;<A HREF="https://lists.berlios.de/mailman/listinfo/fetchmail-users">mexas at bristol.ac.uk</A>&quot; *
fetchmail: IMAP&lt; A0002 NO Invalid credentials c4if10832046wiw.48
fetchmail: Authorization failure on <A HREF="https://lists.berlios.de/mailman/listinfo/fetchmail-users">mexas at bristol.ac.uk</A>@gmail-imap.l.google.com
fetchmail: For help, see <A HREF="http://www.fetchmail.info/fetchmail-FAQ.html#R15">http://www.fetchmail.info/fetchmail-FAQ.html#R15</A>
fetchmail: IMAP&gt; A0003 LOGOUT
fetchmail: IMAP&lt; * BYE Logout Requested c4if10832046wiw.48
fetchmail: IMAP&lt; A0003 OK Quoth the raven, nevermore... c4if10832046wiw.48
fetchmail: 6.3.21 querying imap.gmail.com (protocol IMAP) at Tue Jul 24 23:47:35
 2012: poll completed
fetchmail: Query status=3 (AUTHFAIL)
fetchmail: normal termination, status 3
$

So I'll check with IT whether imap.gmail.com
has been confitured for us already.

&gt;<i> 
</I>&gt;<i> Hope that helps.
</I>&gt;<i> 
</I>&gt;<i> Note, if you plan to discuss anything fetchmail-on-FreeBSD-specific on
</I>&gt;<i> FreeBSD lists, feel free to Cc: me on your list mail.
</I>
ok, many thanks

-- 
Anton Shterenlikht
Room 2.6, Queen's Building
Mech Eng Dept
Bristol University
University Walk, Bristol BS8 1TR, UK
Tel: +44 (0)117 331 5944
Fax: +44 (0)117 929 4423
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003193.html">[fetchmail-users] ssl troubles
</A></li>
	<LI>Next message: <A HREF="003195.html">[fetchmail-users] ssl troubles
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3194">[ date ]</a>
              <a href="thread.html#3194">[ thread ]</a>
              <a href="subject.html#3194">[ subject ]</a>
              <a href="author.html#3194">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/fetchmail-users">More information about the fetchmail-users
mailing list</a><br>
</body></html>
